<!DOCTYPE html><html lang="ru"><head><script>window.currentUser = null;</script><script>window.rateUsdToNative = 65.69;</script><title itemprop="name">Куки, document.cookie</title><link href="pack/styles.ce210dd933f17ce8be6f.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="https://learn.javascript.ru/cookie"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="Куки, document.cookie"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Куки, document.cookie"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="drag-and-drop-plus.html"><link rel="next" href="intl.html"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="http://mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="pack/init.ce210dd933f17ce8be6f.js"></script><script src="pack/head.ce210dd933f17ce8be6f.js" defer></script><meta property="og:title" content="Куки, document.cookie"><meta property="og:type" content="article"><script src="pack/tutorial.ce210dd933f17ce8be6f.js" defer></script><script src="pack/footer.ce210dd933f17ce8be6f.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Извините, IE&lt;10 не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="index.html"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="index.html">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="courses.1.html">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://es5.javascript.ru">ES5</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="quiz.html">Тесты знаний</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="jobs.1.html">Стажировки</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="nodejs-screencast.html">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/webpack.html">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/gulp.html">Gulp 4</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/react.html">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/angular.html">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/git.html">Git</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="ebook.1.html"><span class="buy-book-button__extra-text">Купить</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form class="sitetoolbar__search" method="GET" action="http://learn.javascript.ru/search"><button class="sitetoolbar__search-toggle" type="button"></button><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" autofocus="autofocus" name="query" placeholder="Искать на Javascript.ru" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="https://es5.javascript.ru">ES5</option><option value="/quiz">Тесты знаний</option><option value="/jobs">Стажировки</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="http://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_gp" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a></div></div></div></div><progress class="tutorial-progress" data-sticky value="8" max="10" data-tooltip="Урок 8 из 10"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1"><a class="breadcrumbs__link" href="index.html" itemprop="url"><span class="breadcrumbs__hidden-text" itemprop="title">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child"><a class="breadcrumbs__link" href="extra.html" itemprop="url"><span itemprop="title">О всякой всячине</span></a></li></ol><h1 class="main__header-title">Куки, document.cookie</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Куки, document.cookie"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>Для чтения и записи cookie используется свойство <code>document.cookie</code>. Однако, оно представляет собой не объект, а строку в специальном формате, для удобной манипуляций с которой нужны дополнительные функции.</p>
<h2><a class="main__anchor" name="chtenie-document-cookie" href="cookie.html#chtenie-document-cookie">Чтение document.cookie</a></h2><p>Наверняка у вас есть cookie, которые привязаны к этому сайту. Давайте полюбуемся на них. Вот так:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="cookie.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="cookie.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">alert( document.cookie );</code></pre>
        </div>
      </div>
      
      </div><p>Эта строка состоит из пар <code>ключ=значение</code>, которые перечисляются через точку с запятой с пробелом <code>&quot;; &quot;</code>.</p>
<p>Значит, чтобы прочитать cookie, достаточно разбить строку по <code>&quot;; &quot;</code>, и затем найти нужный ключ. Это можно делать либо через <code>split</code> и работу с массивом, либо через регулярное выражение.</p>
<h2><a class="main__anchor" name="funktsiya-getcookie-name" href="cookie.html#funktsiya-getcookie-name">Функция getCookie(name)</a></h2><p>Следующая функция <code>getCookie(name)</code> возвращает cookie с именем <code>name</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// возвращает cookie с именем name, если есть, если нет, то undefined
function getCookie(name) {
  var matches = document.cookie.match(new RegExp(
    &quot;(?:^|; )&quot; + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + &quot;=([^;]*)&quot;
  ));
  return matches ? decodeURIComponent(matches[1]) : undefined;
}</code></pre>
        </div>
      </div>
      
      </div><p>Обратим внимание, что значение может быть любым. Если оно содержит символы, нарушающие форматирование, например, пробелы или <code>;</code>, то оно кодируется при помощи <code>encodeURIComponent</code>. Функция <code>getCookie</code> автоматически раскодирует его.</p>
<h2><a class="main__anchor" name="zapis-v-document-cookie" href="cookie.html#zapis-v-document-cookie">Запись в document.cookie</a></h2><p>В <code>document.cookie</code> можно писать. При этом запись не перезаписывает существующие cookie, а дополняет к ним!</p>
<p>Например, такая строка поставит cookie с именем <code>userName</code> и значением <code>Vasya</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="cookie.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="cookie.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">document.cookie = &quot;userName=Vasya&quot;;</code></pre>
        </div>
      </div>
      
      </div><p>…Однако, всё не так просто. У cookie есть ряд важных настроек, которые очень желательно указать, так как значения по умолчанию у них неудобны.</p>
<p>Эти настройки указываются после пары ключ=значение, каждое – после точки с запятой:</p>
<dl>
<dt><code>path=/mypath</code></dt>
<dd>
<p>Путь, внутри которого будет доступ к cookie. Если не указать, то имеется в виду текущий путь и все пути ниже него.</p>
<p>Как правило, используется <code>path=/</code>, то есть cookie доступно со всех страниц сайта.</p>
</dd>
<dt><code>domain=site.com</code></dt>
<dd>
<p>Домен, на котором доступно cookie. Если не указать, то текущий домен. Допустимо указывать текущий домен <code>site.com</code> и его поддомены, например <code>forum.site.com</code>.</p>
<p>Если указать специальную маску <code>.site.com</code>, то cookie будет доступно на сайте и всех его поддоменах. Это используется, например, в случаях, когда кука содержит данные авторизации и должна быть доступна как на <code>site.com</code>, так и на <code>forum.site.com</code>.</p>
</dd>
<dt><code>expires=Tue, 19 Jan 2038 03:14:07 GMT</code></dt>
<dd>
<p>Дата истечения куки в формате GMT. Получить нужную дату можно, используя объект <code>Date</code>. Его можно установить в любое время, а потом вызвать <code>toUTCString()</code>, например:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// +1 день от текущего момента
var date = new Date;
date.setDate(date.getDate() + 1);
alert( date.toUTCString() );</code></pre>
        </div>
      </div>
      
      </div><p>Если дату не указать, то cookie будет считаться «сессионным». Такое cookie удаляется при закрытии браузера.
Если дата в прошлом, то кука будет удалена.</p>
</dd>
<dt><code>secure</code></dt>
<dd>
<p>Cookie можно передавать только по HTTPS.</p>
</dd>
</dl>
<p>Например, чтобы поставить cookie <code>name=value</code> по текущему пути с датой истечения через 60 секунд:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="cookie.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="cookie.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var date = new Date(new Date().getTime() + 60 * 1000);
document.cookie = &quot;name=value; path=/; expires=&quot; + date.toUTCString();</code></pre>
        </div>
      </div>
      
      </div><p>Чтобы удалить это cookie:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="cookie.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="cookie.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var date = new Date(0);
document.cookie = &quot;name=; path=/; expires=&quot; + date.toUTCString();</code></pre>
        </div>
      </div>
      
      </div><p>При удалении значение не важно. Можно его не указывать, как сделано в коде выше.</p>
<h2><a class="main__anchor" name="funktsiya-setcookie-name-value-options" href="cookie.html#funktsiya-setcookie-name-value-options">Функция setCookie(name, value, options)</a></h2><p>Если собрать все настройки воедино, вот такая функция ставит куки:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function setCookie(name, value, options) {
  options = options || {};

  var expires = options.expires;

  if (typeof expires == &quot;number&quot; &amp;&amp; expires) {
    var d = new Date();
    d.setTime(d.getTime() + expires * 1000);
    expires = options.expires = d;
  }
  if (expires &amp;&amp; expires.toUTCString) {
    options.expires = expires.toUTCString();
  }

  value = encodeURIComponent(value);

  var updatedCookie = name + &quot;=&quot; + value;

  for (var propName in options) {
    updatedCookie += &quot;; &quot; + propName;
    var propValue = options[propName];
    if (propValue !== true) {
      updatedCookie += &quot;=&quot; + propValue;
    }
  }

  document.cookie = updatedCookie;
}</code></pre>
        </div>
      </div>
      
      </div><p>Аргументы:</p>
<dl>
<dt>name</dt>
<dd>
<p>название cookie</p>
</dd>
<dt>value</dt>
<dd>
<p>значение cookie (строка)</p>
</dd>
<dt>options</dt>
<dd>
<p>Объект с дополнительными свойствами для установки cookie:</p>
</dd>
<dt>expires</dt>
<dd>
<p>Время истечения cookie. Интерпретируется по-разному, в зависимости от типа:</p>
<ul>
<li>Число – количество секунд до истечения. Например, <code>expires: 3600</code> – кука на час.</li>
<li>Объект типа <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a> – дата истечения.</li>
<li>Если expires в прошлом, то cookie будет удалено.</li>
<li>Если expires отсутствует или <code>0</code>, то cookie будет установлено как сессионное и исчезнет при закрытии браузера.</li>
</ul>
</dd>
<dt>path</dt>
<dd>
<p>Путь для cookie.</p>
</dd>
<dt>domain</dt>
<dd>
<p>Домен для cookie.</p>
</dd>
<dt>secure</dt>
<dd>
<p>Если <code>true</code>, то пересылать cookie только по защищенному соединению.</p>
</dd>
</dl>
<h2><a class="main__anchor" name="funktsiya-deletecookie-name" href="cookie.html#funktsiya-deletecookie-name">Функция deleteCookie(name)</a></h2><p>Здесь всё просто – удаляем вызовом <code>setCookie</code> с датой в прошлом.</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">function deleteCookie(name) {
  setCookie(name, &quot;&quot;, {
    expires: -1
  })
}</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="storonnie-cookie" href="cookie.html#storonnie-cookie">Сторонние cookie</a></h2><p>При работе с cookie есть важная тонкость, которая касается внешних ресурсов.</p>
<p>Теоретически, любой ресурс, который загружает браузер, может поставить cookie.</p>
<p>Например:</p>
<ul>
<li>Если на странице есть <code>&lt;img src=&quot;http://mail.ru/counter.gif&quot;&gt;</code>, то вместе с картинкой в ответ сервер может прислать заголовки, устанавливающие cookie.</li>
<li>Если на странице есть <code>&lt;iframe src=&quot;http://facebook.com/button.php&quot;&gt;</code>, то во-первых сервер может вместе с <code>button.php</code> прислать cookie, а во-вторых JS-код внутри ифрейма может записать в <code>document.cookie</code></li>
</ul>
<p>При этом cookie будут принадлежать тому домену, который их поставил. То есть, на <code>mail.ru</code> для первого случая, и на <code>facebook.com</code> во втором.</p>
<p><strong>Такие cookie, которые не принадлежат основной странице, называются «сторонними» (3rd party) cookies. Не все браузеры их разрешают.</strong></p>
<p>Как правило, в настройках браузера можно поставить «Блокировать данные и файлы cookie сторонних сайтов» (Chrome).</p>
<p><strong>В Safari такая настройка включена по умолчанию и выглядит так:</strong></p>
<figure><div class="image" style="width:651px">
      <div class="image__ratio" style="padding-top:32.565284178187405%"></div>
      <img src="article/cookie/safari-nocookie.png" alt="" width="651" height="212" class="image__image">
      </div></figure><h3><a class="main__anchor" name="ts-s-s-bolshoy-brat-smotrit-za-toboy" href="cookie.html#ts-s-s-bolshoy-brat-smotrit-za-toboy">Тс-с-с. Большой брат смотрит за тобой.</a></h3><p>Цель этого запрета – защитить посетителей от слежки со стороны рекламодателей, которые вместе с картинкой-баннером присылают и куки, таким образом помечая посетителей.</p>
<p>Например, на многих сайтах стоят баннеры и другая реклама Google Ads. При помощи таких cookie компания Google будет знать, какие именно сайты вы посещаете, сколько времени вы на них проводите и многое другое.</p>
<p>Как? Да очень просто – на каждом сайте загружается, к примеру, картинка с рекламой. При этом баннер берётся с домена, принадлежащего Google. Вместе с баннером Google ставит cookie со специальным уникальным идентификатором.</p>
<p>Далее, при следующем запросе на баннер, браузер пошлёт стандартные заголовки, которые включают в себя:</p>
<ul>
<li>Cookie с домена баннера, то есть уникальный идентификатор, который был поставлен ранее.</li>
<li>Стандартный заголовок Referrer (его не будет при HTTPS!), который говорит, с какого сайта сделан запрос. Да, впрочем, Google и так знает, с какого сайта запрос, ведь идентификатор сайта есть в URL.</li>
</ul>
<p>Так что Google может хранить в своей базе, какие именно сайты из тех, на которых есть баннер Google, вы посещали, когда вы на них были, и т.п. Этот идентификатор легко привязывается к остальной информации от других сервисов, и таким образом картина слежки получается довольно-таки глобальной.</p>
<p>Здесь я не утверждаю, что в конкретной компании Google всё именно так… Но во-первых, сделать так легко, во-вторых идентификаторы действительно ставятся, а в-третьих, такие знания о человеке позволяют решать, какую именно рекламу и когда ему показать. А это основная доля доходов Google, благодаря которой корпорация существует.</p>
<p>Возможно, компания Apple, которая выпустила Safari, поставила такой флаг по умолчанию именно для уменьшения влияния Google?</p>
<h3><a class="main__anchor" name="a-esli-ochen-nado" href="cookie.html#a-esli-ochen-nado">А если очень надо?</a></h3><p>Итак, Safari запрещает сторонние cookie по умолчанию. Другие браузеры предоставляют такую возможность, если посетитель захочет.</p>
<p><strong>А что, если ну очень надо поставить стороннюю cookie, и чтобы это было надёжно?</strong></p>
<p>Такая задача действительно возникает, например, в системе кросс-доменной авторизации, когда есть несколько доменов 2-го уровня, и хочется, чтобы посетитель, который входит в один сайт, автоматически распознавался во всей сетке. При этом cookie для авторизации ставятся на главный домен – «мастер», а остальные сайты запрашивают их при помощи специального скрипта (и, как правило, копируют к себе для оптимизации, но здесь это не суть).</p>
<p>Ещё пример – когда есть внешний виджет, например, <code>iframe</code> с информационным сервисом, который можно подключать на разные сайты. И этот <code>iframe</code> должен знать что-то о посетителе, опять же, авторизация или какие-то настройки, которые хорошо бы хранить в cookie.</p>
<p>Есть несколько способов поставить 3rd-party cookie для Safari.</p>
<dl>
<dt>Использовать ифрейм.</dt>
<dd>
<p>Ифрейм является полноценным окном браузера. В нём должна быть доступна вся функциональность, в том числе cookie. Как браузер решает, что ифрейм «сторонний» и нужно запретить для него и его скриптов установку cookie? Критерий таков: «в ифрейме нет навигации». Если навигация есть, то ифрейм признаётся полноценным окном.</p>
<p>Например, в сторонний <code>iframe</code> можно сделать POST. И тогда, в ответ на POST, сервер может поставить cookie. Или прислать документ, который это делает. Ифрейм, в который прошёл POST, считается родным и надёжным.</p>
</dd>
<dt>Popup-окно</dt>
<dd>
<p>Другой вариант – использовать popup, то есть при помощи <code>window.open</code> открывать именно окно со стороннего домена, и уже там ставить cookie. Это тоже работает.</p>
</dd>
<dt>Редирект</dt>
<dd>
<p>Ещё одно альтернативное решение, которое подходит не везде – это сделать интеграцию со сторонним доменом, такую что на него можно сделать редирект, он ставит cookie и делает редирект обратно.</p>
</dd>
</dl>
<h2><a class="main__anchor" name="dopolnitelno" href="cookie.html#dopolnitelno">Дополнительно</a></h2><ul>
<li>
<p>На Cookie наложены ограничения:</p>
<ul>
<li>Имя и значение (после <code>encodeURIComponent</code>) вместе не должны превышать 4кб.</li>
<li>Общее количество cookie на домен ограничено 30-50, в зависимости от браузера.</li>
<li>Разные домены 2-го уровня полностью изолированы. Но в пределах доменов 3-го уровня куки можно ставить свободно с указанием <code>domain</code>.</li>
<li>Сервер может поставить cookie с дополнительным флагом <code>HttpOnly</code>. Cookie с таким параметром передаётся только в заголовках, оно никак не доступно из JavaScript.</li>
</ul>
</li>
<li>
<p>Иногда посетители отключают cookie. Отловить это можно проверкой свойства <a href="https://developer.mozilla.org/en-US/docs/DOM/window.navigator.cookieEnabled">navigator.cookieEnabled</a></p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="cookie.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="cookie.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">if (!navigator.cookieEnabled) {
  alert( 'Включите cookie для комфортной работы с этим сайтом' );
}</code></pre>
        </div>
      </div>
      
      </div><p>…Конечно, предполагается, что включён JavaScript. Впрочем, посетитель без JS и cookie с большой вероятностью не человек, а бот.</p>
</li>
</ul>
<h2><a class="main__anchor" name="itogo" href="cookie.html#itogo">Итого</a></h2><p>Файл с функциями для работы с cookie: <a href="article/cookie/cookie.js">cookie.js</a>.</p>
</div></article></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="drag-and-drop-plus.html" data-tooltip="Применяем ООП: Drag'n'Drop++"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="intl.html" data-tooltip="Intl: интернационализация в JavaScript"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_gp" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a></div><div class="article-tablet-foot__map"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="courses.1.html">курсы по Javascript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="cookie.html#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Приветствуются комментарии, содержащие дополнения и вопросы по статье, и ответы на них.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com'>JSBin</a>, <a href='http://codepen.io'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/cookie","identifier":"\/cookie"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="extra.html">О всякой всячине</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#chtenie-document-cookie">Чтение document.cookie</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#funktsiya-getcookie-name">Функция getCookie(name)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#zapis-v-document-cookie">Запись в document.cookie</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#funktsiya-setcookie-name-value-options">Функция setCookie(name, value, options)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#funktsiya-deletecookie-name">Функция deleteCookie(name)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#storonnie-cookie">Сторонние cookie</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#dopolnitelno">Дополнительно</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#itogo">Итого</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="cookie.html#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_gp sidebar__share" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a><a class="share share_vk sidebar__share" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fcookie"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/iliakan/javascript-tutorial-ru/blob/master/11-extra/10-cookie/article.md">Редактировать на Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Илья Кантор</li><li class="page-footer__item"><a class="page-footer__link" href="about.html#contact-us">связаться с нами</a></li><li class="page-footer__item"><a class="page-footer__link" href="terms.html">пользовательское соглашение</a></li><li class="page-footer__item"><a class="page-footer__link" href="privacy.html">политика конфиденциальности</a></li><li class="page-footer__item"><a class="page-footer__slack" href="http://slack.javascript.ru">slack-чат</a></li><li class="page-footer__item"><a class="page-footer__link" href="about.html">о проекте</a></li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li><a class="page-footer__link" rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-ru">open source</a></li></ul></div></div></body></html>