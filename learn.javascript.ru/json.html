<!DOCTYPE html><html lang="ru"><head><script>window.currentUser = null;</script><script>window.rateUsdToNative = 65.69;</script><title itemprop="name">Формат JSON, метод toJSON</title><link href="pack/styles.ce210dd933f17ce8be6f.css" rel="stylesheet"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, minimum-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><!-- chrome autotranslate is enabled only for "en" main version--><meta name="google" content="notranslate"><script>if (window.devicePixelRatio > 1) document.cookie = 'pixelRatio=' + window.devicePixelRatio + ';path=/;expires=Tue, 19 Jan 2038 03:14:07 GMT';</script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700%7COpen+Sans+Condensed:700&amp;subset=latin,latin-ext,cyrillic,cyrillic-ext" rel="stylesheet"><link rel="apple-touch-icon-precomposed" href="img/favicon/apple-touch-icon-precomposed.png"><link rel="canonical" href="https://learn.javascript.ru/json"><meta name="msapplication-TileColor" content="#222A2C"><meta name="msapplication-TileImage" content="/img/favicon/tileicon.png"><link rel="icon" href="img/favicon/favicon.png"><meta itemprop="image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><meta property="og:title" content="Формат JSON, метод toJSON"><meta property="og:image" content="https://learn.javascript.ru/img/site_preview_ru_1200x630.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="fb:admins" content="100001562528165"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Формат JSON, метод toJSON"><meta name="twitter:site" content="@iliakan"><meta name="twitter:creator" content="@iliakan"><meta name="twitter:image" content="https://learn.javascript.ru/img/site_preview_ru_512x512.png"><link rel="prev" href="class-instanceof.html"><link rel="next" href="settimeout-setinterval.html"><script>window.GA_ID = "UA-2056213-16";</script><script>window.GTM_ID = 'GTM-WD2DZPG'</script><script>window.YANDEX_METRIKA_ID = 17649010;</script><script>window.GoogleAnalyticsObject="ga",window.ga=function(){window.ga.q.push(arguments)},window.ga.q=[],window.ga.l=Date.now(),ga("create",GA_ID,"auto"),window.GTM_ID&&ga("require",GTM_ID),window.currentUser?ga("set","&uid",currentUser.id):ga("set","anonymizeIp",!0),window.addEventListener("error",function(e){var r=(e.filename||e.errorUrl)+": "+(e.lineno||e.errorLine),n=e.stack||e.error&&e.error.stack;ga("send","exception",{exDescription:e.message+" "+r+" "+n,exFatal:!0})});</script><script src="https://www.google-analytics.com/analytics.js" async></script><script>ga('send', 'pageview');</script><script>window.metrika={reachGoal:function(){}},window.yandex_metrika_callbacks=[function(){try{window.metrika=new Ya.Metrika({id:YANDEX_METRIKA_ID,webvisor:!0,clickmap:!0,params:{user:window.currentUser&&window.currentUser.id}}),metrika.trackLinks({delay:150}),window.addEventListener("error",function(r){window.metrika.reachGoal("JSERROR",{src:(r.filename||r.errorUrl)+": "+(r.lineno||r.errorLine),stack:r.stack||r.error&&r.error.stack,message:r.message})})}catch(r){}}];</script><script src="http://mc.yandex.ru/metrika/watch.js" async></script><script>window.RECAPTCHA_ID = "6Lf9NyETAAAAACZlg-a9Us2SxvYbeVC1ROWaWv4O";</script><script src="pack/init.ce210dd933f17ce8be6f.js"></script><script src="pack/head.ce210dd933f17ce8be6f.js" defer></script><script>
function voteSync(outputElem) {
  var xhr = new XMLHttpRequest(); // (1)

  xhr.open('GET', '/files/tutorial/ajax/xhr/vote.php', false);
  xhr.send(null);   // (2)

  outputElem.innerHTML = xhr.responseText;  // (3)
}

function vote(outputElem) {
  var xhr = new XMLHttpRequest();

  xhr.open('GET', '/files/tutorial/ajax/xhr/vote.php', true);

  xhr.onreadystatechange = function() {
    if (xhr.readyState != 4) return;
    outputElem.innerHTML = xhr.responseText;
  }

  xhr.send(null);
}
</script><meta property="og:title" content="Формат JSON, метод toJSON"><meta property="og:type" content="article"><script src="pack/tutorial.ce210dd933f17ce8be6f.js" defer></script><script src="pack/footer.ce210dd933f17ce8be6f.js" defer></script></head><body class="no-icons"><script>window.fontTest();</script><div class="page-wrapper page-wrapper_sidebar_on"><!--[if lt IE 10]><div style="color:red;text-align:center">Извините, IE&lt;10 не поддерживается, пожалуйста используйте более новый браузер.</div><![endif]--><div class="sitetoolbar sitetoolbar_tutorial"><div class="sitetoolbar__content"><div class="sitetoolbar__logo-wrap"><a class="sitetoolbar__link sitetoolbar__link_logo" href="index.html"><img class="sitetoolbar__logo sitetoolbar__logo_normal" src="img/sitetoolbar__logo_ru.svg" width="171" alt="" role="presentation"/><img class="sitetoolbar__logo sitetoolbar__logo_small" src="img/sitetoolbar__logo_small_ru.svg" width="80" alt="" role="presentation"/><script>Array.prototype.forEach.call(document.querySelectorAll("img.sitetoolbar__logo"),function(e){let t=document.createElement("object");t.type="image/svg+xml",t.className=e.className,t.style.cssText="left:0;top:0;position:absolute",t.onload=function(){t.onload=null,e.style.visibility="hidden"},t.data=e.src,e.parentNode.insertBefore(t,e)});</script></a></div><div class="sitetoolbar__nav-toggle-wrap"><button class="sitetoolbar__nav-toggle" type="button"></button></div><nav class="sitetoolbar__sections"><ul class="sitetoolbar__sections-list"><li class="sitetoolbar__section sitetoolbar__section_current"><a class="sitetoolbar__link" href="index.html">Учебник</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="courses.1.html">Курсы</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://javascript.ru/forum/">Форум</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="https://es5.javascript.ru">ES5</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="quiz.html">Тесты знаний</a></li><li class="sitetoolbar__section"><a class="sitetoolbar__link" href="jobs.1.html">Стажировки</a></li><li class="sitetoolbar__section sitetoolbar__section_dropdown"><button class="sitetoolbar__dropdown-button" data-dropdown-toggler>Скринкасты</button><div class="sitetoolbar__dropdown-wrap"><div class="sitetoolbar__dropdown-body"><ul class="sitetoolbar__dropdown-items"><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="nodejs-screencast.html">Node.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/webpack.html">Webpack</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/gulp.html">Gulp 4</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/react.html">React.js</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/angular.html">Angular</a></li><li class="sitetoolbar__dropdown-item"><a class="sitetoolbar__secondary-link sitetoolbar__dropdown-link" href="screencast/git.html">Git</a></li></ul></div></div></li></ul></nav><div class="sitetoolbar__book-wrap"><a class="buy-book-button" href="ebook.1.html"><span class="buy-book-button__extra-text">Купить</span>EPUB/PDF</a></div><div class="sitetoolbar__login-wrap"><button class="sitetoolbar__login sitetoolbar__login_unready" data-action-login></button></div><div class="sitetoolbar__search-wrap"><div class="sitetoolbar__search-content"><form class="sitetoolbar__search" method="GET" action="http://learn.javascript.ru/search"><button class="sitetoolbar__search-toggle" type="button"></button><div class="sitetoolbar__search-input"><div class="text-input"><input class="text-input__control" autofocus="autofocus" name="query" placeholder="Искать на Javascript.ru" type="text"/></div><button class="sitetoolbar__find" type="submit">Найти</button></div></form></div></div></div><div class="tablet-menu"><div class="tablet-menu__line"><div class="tablet-menu__content"><select class="tablet-menu__nav input-select input-select input-select_small" onchange="if(this.value) window.location.href=this.value"><option value="/" selected>Учебник</option><option value="/courses">Курсы</option><option value="https://javascript.ru/forum/">Форум</option><option value="https://es5.javascript.ru">ES5</option><option value="/quiz">Тесты знаний</option><option value="/jobs">Стажировки</option></select></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><form class="tablet-menu-search" action="http://learn.javascript.ru/search/"><input class="tablet-menu-search__input" type="search" name="query" placeholder="Поиск в учебнике" required="required"/><button class="tablet-menu-search__button" type="submit" name="type" value="articles">Поиск</button></form></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div><div class="tablet-menu__line"><div class="tablet-menu__content"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_gp" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a></div></div></div></div><progress class="tutorial-progress" data-sticky value="57" max="86" data-tooltip="Урок 57 из 86"></progress></div><div class="page page_sidebar_on page_inner_padding"><script>if(localStorage.noSidebar){document.querySelector(".page").classList.remove("page_sidebar_on");var pageWrapper=document.querySelector(".page-wrapper");pageWrapper&&pageWrapper.classList.remove("page-wrapper_sidebar_on")}setTimeout(function(){document.querySelector(".page").classList.add("page_sidebar-animation-on")},0);</script><div class="page__inner"><main class="main main_width-limit"><header class="main__header"><div class="main__header-inner"><ol class="breadcrumbs"><li class="breadcrumbs__item breadcrumbs__item_home" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-1"><a class="breadcrumbs__link" href="index.html" itemprop="url"><span class="breadcrumbs__hidden-text" itemprop="title">Учебник</span></a></li><li class="breadcrumbs__item" id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemref="breadcrumb-2" itemprop="child"><a class="breadcrumbs__link" href="js.html" itemprop="url"><span itemprop="title">Язык JavaScript</span></a></li><li class="breadcrumbs__item" id="breadcrumb-2" itemscope itemtype="http://data-vocabulary.org/Breadcrumb" itemprop="child"><a class="breadcrumbs__link" href="js-misc.html" itemprop="url"><span itemprop="title">Некоторые другие возможности</span></a></li></ol><h1 class="main__header-title">Формат JSON, метод toJSON</h1></div></header><div class="content"><article class="formatted" itemscope itemtype="http://schema.org/TechArticle"><meta itemprop="name" content="Формат JSON, метод toJSON"><div itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="email" content="iliakan@gmail.com"><meta itemprop="name" content="Ilya Kantor"></div><div itemprop="articleBody"><p>В этой главе мы рассмотрим работу с форматом <a href="http://ru.wikipedia.org/wiki/JSON">JSON</a>, который используется для представления объектов в виде строки.</p>
<p>Это один из наиболее удобных форматов данных при взаимодействии с JavaScript. Если нужно с сервера взять объект с данными и передать его клиенту, то в качестве промежуточного формата – для передачи по сети, почти всегда используют именно его.</p>
<p>В современных браузерах есть замечательные методы, знание тонкостей которых делает операции с JSON простыми и комфортными.</p>
<h2><a class="main__anchor" name="format-json" href="json.html#format-json">Формат JSON</a></h2><p>Данные в формате JSON (<a href="http://tools.ietf.org/html/rfc4627">RFC 4627</a>) представляют собой:</p>
<ul>
<li>JavaScript-объекты <code>{ ... }</code> или</li>
<li>Массивы <code>[ ... ]</code> или</li>
<li>Значения одного из типов:
<ul>
<li>строки в двойных кавычках,</li>
<li>число,</li>
<li>логическое значение <code>true</code>/<code>false</code>,</li>
<li><code>null</code>.</li>
</ul>
</li>
</ul>
<p>Почти все языки программирования имеют библиотеки для преобразования объектов в формат JSON.</p>
<p>Основные методы для работы с JSON в JavaScript – это:</p>
<ul>
<li><code>JSON.parse</code> – читает объекты из строки в формате JSON.</li>
<li><code>JSON.stringify</code> – превращает объекты в строку в формате JSON, используется, когда нужно из JavaScript передать данные по сети.</li>
</ul>
<h2><a class="main__anchor" name="metod-json-parse" href="json.html#metod-json-parse">Метод JSON.parse</a></h2><p>Вызов <code>JSON.parse(str)</code> превратит строку с данными в формате JSON в JavaScript-объект/массив/значение.</p>
<p>Например:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var numbers = &quot;[0, 1, 2, 3]&quot;;

numbers = JSON.parse(numbers);

alert( numbers[1] ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>Или так:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = '{ &quot;name&quot;: &quot;Вася&quot;, &quot;age&quot;: 35, &quot;isAdmin&quot;: false, &quot;friends&quot;: [0,1,2,3] }';

user = JSON.parse(user);

alert( user.friends[1] ); // 1</code></pre>
        </div>
      </div>
      
      </div><p>Данные могут быть сколь угодно сложными, объекты и массивы могут включать в себя другие объекты и массивы. Главное, чтобы они соответствовали формату.</p>
<div class="important important_warn">
            <div class="important__header"><span class="important__type">JSON-объекты ≠ JavaScript-объекты</span></div>
            <div class="important__content"><p>Объекты в формате JSON похожи на обычные JavaScript-объекты, но отличаются от них более строгими требованиями к строкам – они должны быть именно в двойных кавычках.</p>
<p>В частности, первые два свойства объекта ниже – некорректны:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:2,&quot;cols&quot;:[{&quot;start&quot;:13,&quot;end&quot;:21}]},{&quot;start&quot;:1,&quot;cols&quot;:[{&quot;start&quot;:2,&quot;end&quot;:6}]}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">{
  name: &quot;Вася&quot;,       // ошибка: ключ name без кавычек!
  &quot;surname&quot;: 'Петров',// ошибка: одинарные кавычки у значения 'Петров'!
  &quot;age&quot;: 35,           // .. а тут всё в порядке.
  &quot;isAdmin&quot;: false    // и тут тоже всё ок
}</code></pre>
        </div>
      </div>
      
      </div><p>Кроме того, в формате JSON не поддерживаются комментарии. Он предназначен только для передачи данных.</p>
<p>Есть нестандартное расширение формата JSON, которое называется <a href="http://json5.org/">JSON5</a> и как раз разрешает ключи без кавычек, комментарии и т.п, как в обычном JavaScript. На данном этапе это отдельная библиотека.</p>
</div></div>
<h2><a class="main__anchor" name="umnyy-razbor-json-parse-str-reviver" href="json.html#umnyy-razbor-json-parse-str-reviver">Умный разбор: JSON.parse(str, reviver)</a></h2><p>Метод <code>JSON.parse</code> поддерживает и более сложные алгоритмы разбора.</p>
<p>Например, мы получили с сервера объект с данными события <code>event</code>.</p>
<p>Он выглядит так:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// title: название события, date: дата события
var str = '{&quot;title&quot;:&quot;Конференция&quot;,&quot;date&quot;:&quot;2014-11-30T12:00:00.000Z&quot;}';</code></pre>
        </div>
      </div>
      
      </div><p>…И теперь нужно <em>восстановить</em> его, то есть превратить в JavaScript-объект.</p>
<p>Попробуем вызвать для этого <code>JSON.parse</code>:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:4,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var str = '{&quot;title&quot;:&quot;Конференция&quot;,&quot;date&quot;:&quot;2014-11-30T12:00:00.000Z&quot;}';

var event = JSON.parse(str);

alert( event.date.getDate() ); // ошибка!</code></pre>
        </div>
      </div>
      
      </div><p>…Увы, ошибка!</p>
<p>Дело в том, что значением <code>event.date</code> является строка, а отнюдь не объект <code>Date</code>. Откуда методу <code>JSON.parse</code> знать, что нужно превратить строку именно в дату?</p>
<p><strong>Для интеллектуального восстановления из строки у <code>JSON.parse(str, reviver)</code> есть второй параметр <code>reviver</code>, который является функцией <code>function(key, value)</code>.</strong></p>
<p>Если она указана, то в процессе чтения объекта из строки <code>JSON.parse</code> передаёт ей по очереди все создаваемые пары ключ-значение и может возвратить либо преобразованное значение, либо <code>undefined</code>, если его нужно пропустить.</p>
<p>В данном случае мы можем создать правило, что ключ <code>date</code> всегда означает дату:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:3,&quot;end&quot;:6}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">// дата в строке - в формате UTC
var str = '{&quot;title&quot;:&quot;Конференция&quot;,&quot;date&quot;:&quot;2014-11-30T12:00:00.000Z&quot;}';

var event = JSON.parse(str, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

alert( event.date.getDate() ); // теперь сработает!</code></pre>
        </div>
      </div>
      
      </div><p>Кстати, эта возможность работает и для вложенных объектов тоже:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:12,&quot;end&quot;:12}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var schedule = '{ \
  &quot;events&quot;: [ \
    {&quot;title&quot;:&quot;Конференция&quot;,&quot;date&quot;:&quot;2014-11-30T12:00:00.000Z&quot;}, \
    {&quot;title&quot;:&quot;День рождения&quot;,&quot;date&quot;:&quot;2015-04-18T12:00:00.000Z&quot;} \
  ]\
}';

schedule = JSON.parse(schedule, function(key, value) {
  if (key == 'date') return new Date(value);
  return value;
});

alert( schedule.events[1].date.getDate() ); // сработает!</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="serializatsiya-metod-json-stringify" href="json.html#serializatsiya-metod-json-stringify">Сериализация, метод JSON.stringify</a></h2><p>Метод <code>JSON.stringify(value, replacer, space)</code> преобразует («сериализует») значение в JSON-строку.</p>
<p>Пример использования:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var event = {
  title: &quot;Конференция&quot;,
  date: &quot;сегодня&quot;
};

var str = JSON.stringify(event);
alert( str ); // {&quot;title&quot;:&quot;Конференция&quot;,&quot;date&quot;:&quot;сегодня&quot;}

// Обратное преобразование.
event = JSON.parse(str);</code></pre>
        </div>
      </div>
      
      </div><p><strong>При сериализации объекта вызывается его метод <code>toJSON</code>.</strong></p>
<p>Если такого метода нет – перечисляются его свойства, кроме функций.</p>
<p>Посмотрим это в примере посложнее:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var room = {
  number: 23,
  occupy: function() {
    alert( this.number );
  }
};

var event = {
  title: &quot;Конференция&quot;,
  date: new Date(Date.UTC(2014, 0, 1)),
  room: room
};

alert( JSON.stringify(event) );
/*
  {
    &quot;title&quot;:&quot;Конференция&quot;,
    &quot;date&quot;:&quot;2014-01-01T00:00:00.000Z&quot;,  // (1)
    &quot;room&quot;: {&quot;number&quot;:23}               // (2)
  }
*/</code></pre>
        </div>
      </div>
      
      </div><p>Обратим внимание на два момента:</p>
<ol>
<li>
<p>Дата превратилась в строку. Это не случайно: у всех дат есть встроенный метод <code>toJSON</code>. Его результат в данном случае – строка в таймзоне UTC.</p>
</li>
<li>
<p>У объекта <code>room</code> нет метода <code>toJSON</code>. Поэтому он сериализуется перечислением свойств.</p>
<p>Мы, конечно, могли бы добавить такой метод, тогда в итог попал бы его результат:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:2,&quot;end&quot;:4}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var room = {
  number: 23,
  toJSON: function() {
      return this.number;
    }
};

alert( JSON.stringify(room) ); // 23</code></pre>
        </div>
      </div>
      
      </div></li>
</ol>
<h3><a class="main__anchor" name="isklyuchenie-svoystv" href="json.html#isklyuchenie-svoystv">Исключение свойств</a></h3><p>Попытаемся преобразовать в JSON объект, содержащий ссылку на DOM.</p>
<p>Например:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;end&quot;:7}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = {
  name: &quot;Вася&quot;,
  age: 25,
  window: window
};

alert( JSON.stringify(user) ); // ошибка!
// TypeError: Converting circular structure to JSON (текст из Chrome)</code></pre>
        </div>
      </div>
      
      </div><p>Произошла ошибка! В чём же дело? Неужели некоторые объекты запрещены? Как видно из текста ошибки – дело совсем в другом. Глобальный объект <code>window</code> – сложная структура с кучей встроенных свойств и круговыми ссылками, поэтому его преобразовать невозможно. Да и нужно ли?</p>
<p><strong>Во втором параметре <code>JSON.stringify(value, replacer)</code> можно указать массив свойств, которые подлежат сериализации.</strong></p>
<p>Например:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;end&quot;:7}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = {
  name: &quot;Вася&quot;,
  age: 25,
  window: window
};

alert( JSON.stringify(user, [&quot;name&quot;, &quot;age&quot;]) );
// {&quot;name&quot;:&quot;Вася&quot;,&quot;age&quot;:25}</code></pre>
        </div>
      </div>
      
      </div><p>Для более сложных ситуаций вторым параметром можно передать функцию <code>function(key, value)</code>, которая возвращает сериализованное <code>value</code> либо <code>undefined</code>, если его не нужно включать в результат:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:6,&quot;end&quot;:9}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = {
  name: &quot;Вася&quot;,
  age: 25,
  window: window
};

var str = JSON.stringify(user, function(key, value) {
  if (key == 'window') return undefined;
  return value;
});

alert( str ); // {&quot;name&quot;:&quot;Вася&quot;,&quot;age&quot;:25}</code></pre>
        </div>
      </div>
      
      </div><p>В примере выше функция пропустит свойство с названием <code>window</code>. Для остальных она просто возвращает значение, передавая его стандартному алгоритму. А могла бы и как-то обработать.</p>
<div class="important important_smart">
            <div class="important__header"><span class="important__type">Функция <code>replacer</code> работает рекурсивно</span></div>
            <div class="important__content"><p>То есть, если объект содержит вложенные объекты, массивы и т.п., то все они пройдут через <code>replacer</code>.</p>
</div></div>
<h3><a class="main__anchor" name="krasivoe-formatirovanie" href="json.html#krasivoe-formatirovanie">Красивое форматирование</a></h3><p>В методе <code>JSON.stringify(value, replacer, space)</code> есть ещё третий параметр <code>space</code>.</p>
<p>Если он является числом – то уровни вложенности в JSON оформляются указанным количеством пробелов, если строкой – вставляется эта строка.</p>
<p>Например:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:9,&quot;end&quot;:9}]">
      <div class="codebox code-example__codebox">
        
        <div class="toolbar codebox__toolbar">
          <div class="toolbar__tool">
            <a href="json.html#" title="выполнить" data-action="run" class="toolbar__button toolbar__button_run"></a>
          </div>
          <div class="toolbar__tool">
            <a href="json.html#" title="открыть в песочнице" target="_blank" data-action="edit" class="toolbar__button toolbar__button_edit"></a>
          </div>
        </div>
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var user = {
  name: &quot;Вася&quot;,
  age: 25,
  roles: {
    isAdmin: false,
    isEditor: true
  }
};

var str = JSON.stringify(user, &quot;&quot;, 4);

alert( str );
/* Результат -- красиво сериализованный объект:
{
    &quot;name&quot;: &quot;Вася&quot;,
    &quot;age&quot;: 25,
    &quot;roles&quot;: {
        &quot;isAdmin&quot;: false,
        &quot;isEditor&quot;: true
    }
}
*/</code></pre>
        </div>
      </div>
      
      </div><h2><a class="main__anchor" name="itogo" href="json.html#itogo">Итого</a></h2><ul>
<li>JSON – формат для представления объектов (и не только) в виде строки.</li>
<li>Методы <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse">JSON.parse</a> и <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify</a> позволяют интеллектуально преобразовать объект в строку и обратно.</li>
</ul>
</div></article><div class="tasks formatted"><h2 class="tasks__title" id="tasks"><a class="tasks__title-anchor main__anchor main__anchor main__anchor_noicon" href="json.html#tasks">Задачи</a></h2><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="json.html#prevratite-obekt-v-json" name="prevratite-obekt-v-json">Превратите объект в JSON</a></h3><a class="task__open-link" href="task/serialize-object.html" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 3</span></div><div class="task__content"><p>Превратите объект <code>leader</code> из примера ниже в JSON:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var leader = {
  name: &quot;Василий Иванович&quot;,
  age: 35
};</code></pre>
        </div>
      </div>
      
      </div><p>После этого прочитайте получившуюся строку обратно в объект.</p>
<button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__answer-content"><div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var leader = {
  name: &quot;Василий Иванович&quot;,
  age: 35
};

var leaderStr = JSON.stringify(leader);
leader = JSON.parse(leaderStr);</code></pre>
        </div>
      </div>
      
      </div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div><div class="task tasks__task"><div class="task__header"><div class="task__title-wrap"><h3 class="task__title"><a class="main__anchor" href="json.html#prevratite-obekty-so-ssylkami-v-json" name="prevratite-obekty-so-ssylkami-v-json">Превратите объекты со ссылками в JSON</a></h3><a class="task__open-link" href="task/serialize-object-circular.html" target="_blank"></a></div><div class="task__header-note"><span class="task__importance" title="Насколько эта задача важна для освоения материала, от 1 до 5">важность: 3</span></div><div class="task__content"><p>Превратите объект <code>team</code> из примера ниже в JSON:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var leader = {
  name: &quot;Василий Иванович&quot;
};

var soldier = {
  name: &quot;Петька&quot;
};

// эти объекты ссылаются друг на друга!
leader.soldier = soldier;
soldier.leader = leader;

var team = [leader, soldier];</code></pre>
        </div>
      </div>
      
      </div><ol>
<li>Может ли это сделать прямой вызов <code>JSON.stringify(team)</code>? Если нет, то почему?</li>
<li>Какой подход вы бы предложили для чтения и восстановления таких объектов?</li>
</ol>
<button class="task__solution" type="button">решение</button><div class="task__answer"><div class="task__step task__step_open"><button class="task__step-show" type="button" onclick="showStep(this)">Ответ на первый вопрос</button><div class="task__answer-content"><h4 class="task__step-title">Ответ на первый вопрос</h4><p>Обычный вызов <code>JSON.stringify(team)</code> выдаст ошибку, так как объекты <code>leader</code> и <code>soldier</code> внутри структуры ссылаются друг на друга.</p>
<p>Формат JSON не предусматривает средств для хранения ссылок.</p>
</div></div><div class="task__step task__step_open"><button class="task__step-show" type="button" onclick="showStep(this)">Варианты решения</button><div class="task__answer-content"><h4 class="task__step-title">Варианты решения</h4><p>Чтобы превращать такие структуры в JSON, обычно используются два подхода:</p>
<ol>
<li>
<p>Добавить в <code>team</code> свой код <code>toJSON</code>:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">team.toJSON = function() {
  /* свой код, который может создавать копию объекта без круговых ссылок и передавать управление JSON.stringify */
}</code></pre>
        </div>
      </div>
      
      </div><p>При этом, конечно, понадобится и своя функция чтения из JSON, которая будет восстанавливать объект, а затем дополнять его круговыми ссылками.</p>
</li>
<li>
<p>Можно учесть возможную проблему в самой структуре, используя вместо ссылок <code>id</code>. Как правило, это несложно, ведь на сервере у данных тоже есть идентификаторы.</p>
<p>Изменённая структура может выглядеть так:</p>
<div data-trusted="1" class="code-example" data-highlight="[{&quot;start&quot;:10,&quot;end&quot;:12}]">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">var leader = {
  id: 12,
  name: &quot;Василий Иванович&quot;
};

var soldier = {
  id: 51,
  name: &quot;Петька&quot;
};

// поменяли прямую ссылку на ID
leader.soldierId = 51;
soldier.leaderId = 12;

var team = {
  12: leader,
  51: soldier
};</code></pre>
        </div>
      </div>
      
      </div><p>…Но действительно ли это решение будет оптимальным? Использовать структуру стало сложнее, и вряд ли это изменение стоит делать лишь из-за JSON. Вот если есть другие преимущества, тогда можно подумать.</p>
</li>
</ol>
<p>Универсальный вариант подхода, описанного выше – это использование особой реализации JSON, которая не входит в стандарт и поддерживает расширенный формат для поддержки ссылок.</p>
<p>Она, к примеру, есть во фреймворке Dojo.</p>
<p>При вызове <code>dojox.json.ref.toJson(team)</code> будет создано следующее строковое представление:</p>
<div data-trusted="1" class="code-example">
      <div class="codebox code-example__codebox">
        
        <div class="codebox__code" data-code="1">
          <pre class="line-numbers language-javascript"><code class="language-javascript">[{&quot;name&quot;:&quot;Василий Иванович&quot;,&quot;soldier&quot;:{&quot;name&quot;:&quot;Петька&quot;,&quot;leader&quot;:{&quot;$ref&quot;:&quot;#0&quot;}}},{&quot;$ref&quot;:&quot;#0.soldier&quot;}]</code></pre>
        </div>
      </div>
      
      </div><p>Метод разбора такой строки – также свой: <code>dojox.json.ref.fromJson</code>.</p>
</div></div><button class="close-button task__answer-close" type="button" title="закрыть"></button></div></div></div></div></div></div><div class="page__nav-wrap"><a class="page__nav page__nav_prev" href="class-instanceof.html" data-tooltip="Типы данных: [[Class]], instanceof и утки"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Предыдущий урок</span></a><a class="page__nav page__nav_next" href="settimeout-setinterval.html" data-tooltip="setTimeout и setInterval"><span class="page__nav-text"><span class="page__nav-text-shortcut"></span></span><span class="page__nav-text-alternate">Следующий урок</span></a></div><div class="article-tablet-foot tablet-only"><div class="article-tablet-foot__layout"><div class="share-icons"><span class="share-icons__title">Поделиться</span><a class="share share_tw" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_fb" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_gp" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_vk" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a></div><div class="article-tablet-foot__map"><a class="map" href="tutorial/map.html" data-action="tutorial-map"><span class="map__text">Карта учебника</span></a></div></div></div><div class="banner-bottom"><div class="banner-bottom__text">Проводим <a href="courses.1.html">курсы по Javascript и фреймворкам</a>.</div><button class="banner-bottom__close" data-banner-close="Courses" data-banner-close-message="Эта информация больше не будет выводиться." title="не показывать"></button></div><script>"hideBannerCourses"in localStorage||(document.querySelector(".banner-bottom").style.display="flex");</script><div class="comments formatted" id="comments"><div class="comments__header"><h2 class="comments__header-title"><a href="json.html#comments" name="comments">Комментарии</a></h2><div class="comments__read-before"><span class="comments__read-before-link">перед тем как писать…</span><div class="comments__read-before-popup"><div class="comments__read-before-popup-i"><ul><li>Приветствуются комментарии, содержащие дополнения и вопросы по статье, и ответы на них.</li><li>Для одной строки кода используйте тег <code>&lt;code&gt;</code>, для нескольких строк кода&nbsp;&mdash; тег <code>&lt;pre&gt;</code>, если больше 10 строк&nbsp;&mdash; ссылку на песочницу (<a href='http://plnkr.co/edit/?p=preview'>plnkr</a>, <a href='http://jsbin.com'>JSBin</a>, <a href='http://codepen.io'>codepen</a>…)</li><li>Если что-то непонятно в статье&nbsp;&mdash; пишите, что именно и с какого места.</li></ul></div></div></div></div></div><div id="disqus_thread"></div><script>var disqus_config = function() { if (!this.page) this.page = {}; Object.assign(this.page, {"url":"https:\/\/learn.javascript.ru\/json","identifier":"\/json"}); };</script><script>var disqus_shortname = "learnjavascriptru";</script><script>var disqus_enabled = true;</script></main></div><div class="sidebar page__sidebar sidebar sidebar_sticky-footer"><button class="sidebar__toggle" data-sidebar-toggle></button><a class="map" href="tutorial/map.html" data-action="tutorial-map" data-tooltip="Карта учебника"></a><div class="sidebar__inner"><div class="sidebar__content"><div class="sidebar__section"><h4 class="sidebar__section-title">Раздел</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="js-misc.html">Некоторые другие возможности</a></li></ul></nav></div><div class="sidebar__section"><h4 class="sidebar__section-title">Навигация по уроку</h4><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#format-json">Формат JSON</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#metod-json-parse">Метод JSON.parse</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#umnyy-razbor-json-parse-str-reviver">Умный разбор: JSON.parse(str, reviver)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#serializatsiya-metod-json-stringify">Сериализация, метод JSON.stringify</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#itogo">Итого</a></li></ul></nav></div><div class="sidebar__section"><nav class="sidebar__navigation"><ul class="sidebar__navigation-links"><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#tasks">Задачи (2)</a></li><li class="sidebar__navigation-link"><a class="sidebar__link" href="json.html#comments">Комментарии</a></li></ul></nav></div><div class="sidebar__section"><div class="sidebar__section-title">Поделиться</div><a class="share share_tw sidebar__share" href="https://twitter.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_fb sidebar__share" href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_gp sidebar__share" href="https://plus.google.com/share?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a><a class="share share_vk sidebar__share" href="https://vkontakte.ru/share.php?url=http%3A%2F%2Flearn.javascript.ru%2Fjson"></a></div><div class="sidebar__section"><a class="sidebar__link" href="https://github.com/iliakan/javascript-tutorial-ru/blob/master/1-js/7-js-misc/2-json/article.md">Редактировать на Github</a></div></div></div></div></div></div><div class="page-footer"><div class="page-footer__left"><ul class="page-footer__list"><li class="page-footer__item">©&nbsp;2007—2018&nbsp; Илья Кантор</li><li class="page-footer__item"><a class="page-footer__link" href="about.html#contact-us">связаться с нами</a></li><li class="page-footer__item"><a class="page-footer__link" href="terms.html">пользовательское соглашение</a></li><li class="page-footer__item"><a class="page-footer__link" href="privacy.html">политика конфиденциальности</a></li><li class="page-footer__item"><a class="page-footer__slack" href="http://slack.javascript.ru">slack-чат</a></li><li class="page-footer__item"><a class="page-footer__link" href="about.html">о проекте</a></li></ul></div><div class="page-footer__right"><ul class="page-footer__list"><li><a class="page-footer__link" rel="nofollow" href="http://github.com/iliakan/javascript-tutorial-ru">open source</a></li></ul></div></div></body></html>